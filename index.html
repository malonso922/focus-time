<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Inter to match ClickUp -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <title>Focus Timer • Countdown + Progress</title>
  <style>
    :root{
      --bg:#111111;         /* ClickUp dark */
      --panel:#161616;      /* card bg */
      --accent:#4da3ff;
      --accent-2:#49d47a;
      --focus:#a970ff;      /* focus ring */
      --text:#eef3ff;
      --muted:#a7b2cc;
      --radius:16px;
    }
    *,*::before,*::after{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg);
      color:var(--text); font:14px/1.4 'Inter', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif;
      display:grid; place-items:center; padding:16px;
    }
    .card{
      width:min(640px,100%); background:var(--panel);
      border:1px solid rgba(255,255,255,.06); border-radius:var(--radius); box-shadow:0 10px 30px rgba(0,0,0,.4);
      padding:16px 16px 18px;
    }
    label{display:block; font-size:12px; color:var(--muted); margin-bottom:4px}
    input,select,button{
      border-radius:10px; border:1px solid rgba(255,255,255,.12); background:#0f0f0f; color:var(--text); padding:10px 12px; outline:none;
      transition:border-color .15s ease, box-shadow .15s ease;
    }
    input:focus,select:focus{
      border-color:var(--focus);
      box-shadow:0 0 0 2px color-mix(in srgb, var(--focus) 35%, transparent);
    }

    /* two fields; Duration aligned to the right edge */
    .grid{display:grid; grid-template-columns:minmax(0,1fr) minmax(0,1fr); gap:10px; align-items:start}
    @media (max-width:640px){.grid{grid-template-columns:minmax(0,1fr)}}
    #durationField{justify-self:end; text-align:right}
    #durationField .row{display:flex; gap:8px; justify-content:flex-end}

    /* progress + dynamic clock on right (bar takes leftover) */
    .bar{height:14px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); border-radius:999px; overflow:hidden}
    .fill{height:100%; width:0%; background:var(--accent); transition:width .3s ease, background .3s ease}
    .barRow{
      display:grid;
      grid-template-columns: 1fr auto; /* long bar + clock as wide as needed */
      gap:10px;
      align-items:center;
    }
    .barRow .bar{width:100%; min-width:0}
    .clockRight{
      text-align:right;
      font-size:28px; font-weight:700; letter-spacing:.5px;
      font-variant-numeric: tabular-nums;
    }

    .meta{display:flex; justify-content:space-between; color:var(--muted); font-size:12px; margin-top:6px}

    /* footer is one row: link left, chips center, icons right */
    .footer{
      display:grid; grid-template-columns:auto 1fr auto; align-items:center;
      gap:10px; margin-top:12px; color:var(--muted)
    }
    .link{color:#b9d4ff; text-decoration:none}
    .link:hover{text-decoration:underline}

    .presets{display:flex; gap:8px; flex-wrap:wrap; justify-content:center}
    .chip{border:1px solid rgba(255,255,255,.15); background:#0f0f0f; padding:6px 10px; border-radius:999px; cursor:pointer; font-weight:600}
    .chip:hover{border-color:var(--accent)}

    .actions{display:flex; gap:8px; align-items:center; justify-self:end}

    /* icon buttons (circle, inverted) */
    .iconbtn{
      width:36px; height:36px; display:grid; place-items:center; border-radius:999px;
      border:none; background:transparent; cursor:pointer; color:#e8f0ff;
    }
    .iconbtn:hover{ color:var(--accent); }
    .iconbtn svg{ width:22px; height:22px; display:block }
    .iconbtn .ring{ fill:none; stroke:currentColor; stroke-width:2 }
    .iconbtn .shape{ fill:currentColor }

    .hidden{display:none!important}
    .banner{margin:-4px 0 8px; font-size:16px; font-weight:800; text-align:center; color:#e6eeff}
  </style>
</head>
<body>
  <div class="card" id="app">
    <div class="banner hidden" id="banner"></div>

    <div class="grid">
      <div id="taskField">
        <label>Task name</label>
        <input id="label" type="text" placeholder="e.g., Series 65 Study Sprint" />
      </div>
      <div id="durationField">
        <label>Duration</label>
        <div class="row">
          <input id="mins" type="number" min="1" step="1" value="25" style="width:110px"/>
          <select id="unit">
            <option value="min" selected>minutes</option>
            <option value="hr">hours</option>
          </select>
        </div>
      </div>
    </div>

    <!-- progress + clock on right -->
    <div style="margin-top:12px">
      <div class="barRow">
        <div class="bar" id="bar"><div class="fill" id="fill"></div></div>
        <div class="clockRight" id="clock">25:00</div>
      </div>
      <div class="meta">
        <div><span id="pct">0%</span> complete</div>
        <div>Elapsed: <span id="elapsed">0:00</span> • Remaining: <span id="remain">25:00</span></div>
      </div>
    </div>

    <!-- footer: link | chips | toggle+reset -->
    <div class="footer">
      <a class="link" href="#" id="shareLink">Share preset</a>

      <!-- chips centered in the same row as icons -->
      <div class="presets" id="presets">
        <span class="chip" data-mins="15">15m</span>
        <span class="chip" data-mins="25">25m</span>
        <span class="chip" data-mins="45">45m</span>
        <span class="chip" data-mins="60">60m</span>
      </div>

      <div class="actions">
        <!-- TOGGLE: play <-> pause -->
        <button class="iconbtn" id="toggleBtn" title="Start" aria-label="Start">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <circle class="ring" cx="12" cy="12" r="10" />
            <path class="shape" d="M10 8v8l6-4z"/> <!-- play -->
          </svg>
        </button>
        <!-- RESET -->
        <button class="iconbtn" id="resetBtn" title="Reset" aria-label="Reset" disabled>
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <circle class="ring" cx="12" cy="12" r="10" />
            <rect class="shape" x="8.5" y="8.5" width="7" height="7" rx="1.2"/>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <audio id="ding" preload="auto">
    <source src="data:audio/mp3;base64,//uQZAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQCAAAACAAACbG1hAAAAAAAz//8AAP//AACQAAACcQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" type="audio/mpeg">
  </audio>

<script>
(function(){
  const $ = id=>document.getElementById(id);
  const label=$('label'), mins=$('mins'), unit=$('unit');
  const clock=$('clock');
  const toggleBtn=$('toggleBtn'), resetBtn=$('resetBtn');
  const bar=$('bar'), fill=$('fill'), pct=$('pct'), elapsed=$('elapsed'), remain=$('remain');
  const ding=$('ding');
  const presets=$('presets');
  const shareLink=$('shareLink');
  const banner=$('banner');
  const taskField=$('taskField');
  const durationField=$('durationField');

  let totalMs=0, startAt=0, elapsedMs=0, timer=null, running=false;

  const clamp=(n,min,max)=>Math.max(min,Math.min(max,n));
  function fmt(ms){
    ms=Math.max(0,Math.floor(ms/1000));
    const h=Math.floor(ms/3600), m=Math.floor((ms%3600)/60), s=ms%60;
    return h? `${h}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}` : `${m}:${String(s).padStart(2,'0')}`;
  }

  function computeTotal(){
    const v=parseFloat(mins.value||0);
    totalMs = (unit.value==='hr'? v*60 : v) * 60*1000;
    totalMs = Math.max(1000,totalMs);
  }

  function updateShare(){
    const params=new URLSearchParams({label:label.value, mins:mins.value, unit:unit.value});
    shareLink.href = `${location.origin}${location.pathname}?${params.toString()}`;
  }

  function draw(){
    const done=clamp(elapsedMs,0,totalMs);
    const p = Math.round( (done/totalMs)*100 );
    fill.style.width = p + '%';
    fill.style.background = p>=100? '#646b7a' : (p<67? 'var(--accent)' : 'var(--accent-2)');
    pct.textContent = p + '%';
    clock.textContent = fmt(totalMs - done);
    elapsed.textContent = fmt(done);
    remain.textContent = fmt(totalMs - done);
  }

  function setState(newRunning){
    running=newRunning;
    toggleBtn.title = running ? 'Pause' : 'Start';
    toggleBtn.setAttribute('aria-label', toggleBtn.title);
    resetBtn.disabled = !running && elapsedMs===0;

    // swap icon: play <-> pause
    toggleBtn.innerHTML = running
      ? `<svg viewBox="0 0 24 24" aria-hidden="true">
           <circle class="ring" cx="12" cy="12" r="10" />
           <rect class="shape" x="9" y="7" width="2.8" height="10" rx="0.8"/>
           <rect class="shape" x="12.8" y="7" width="2.8" height="10" rx="0.8"/>
         </svg>`
      : `<svg viewBox="0 0 24 24" aria-hidden="true">
           <circle class="ring" cx="12" cy="12" r="10" />
           <path class="shape" d="M10 8v8l6-4z"/>
         </svg>`;
  }

  function start(){
    computeTotal();
    if(elapsedMs>=totalMs){ elapsedMs=0; }
    if(!running){ startAt=Date.now()-elapsedMs; timer=requestAnimationFrame(tick); }
    setState(true);
    // show banner; hide inputs + chips
    banner.textContent = label.value || 'Untitled Task';
    banner.classList.remove('hidden');
    taskField.classList.add('hidden');
    durationField.classList.add('hidden');
    presets.classList.add('hidden');
  }

  function pause(){
    if(running){ cancelAnimationFrame(timer); elapsedMs=Date.now()-startAt; setState(false); draw(); }
  }

  function reset(){
    cancelAnimationFrame(timer); elapsedMs=0; setState(false); draw();
    // restore UI
    banner.classList.add('hidden');
    taskField.classList.remove('hidden');
    durationField.classList.remove('hidden');
    presets.classList.remove('hidden');
  }

  function tick(){
    elapsedMs = Date.now()-startAt;
    if(elapsedMs>=totalMs){
      elapsedMs=totalMs; draw(); setState(false);
      try{ ding.currentTime=0; ding.play().catch(()=>{});}catch(e){}
      try{ if('Notification' in window && Notification.permission==='granted'){ new Notification('Timer done', { body: label.value || 'Focus timer complete' }); } }catch(e){}
      return;
    }
    draw(); timer=requestAnimationFrame(tick);
  }

  // events
  [label, mins, unit].forEach(el=>{
    el.addEventListener('input',()=>{ updateShare(); localSave(); draw(); });
    el.addEventListener('change',()=>{ updateShare(); localSave(); draw(); });
  });

  toggleBtn.addEventListener('click', ()=>{
    running ? pause() : start();
    localSave();
  });
  resetBtn.addEventListener('click', ()=>{ reset(); localSave(); });

  presets.addEventListener('click', (e)=>{
    const chip=e.target.closest('.chip');
    if(!chip) return;
    mins.value = chip.dataset.mins;
    unit.value = 'min';
    elapsedMs=0; draw(); updateShare(); localSave();
  });

  document.addEventListener('keydown', (e)=>{
    if(e.code==='Space'){ e.preventDefault(); running ? pause() : start(); }
    if(e.key==='r' || e.key==='R'){ reset(); }
  });
  try{ if('Notification' in window && Notification.permission==='default'){ Notification.requestPermission().catch(()=>{}); } }catch(e){}

  function localSave(){
    const data={label:label.value, mins:mins.value, unit:unit.value};
    try{ localStorage.setItem('focus-timer-v1', JSON.stringify(data)); }catch(e){}
  }
  function localLoad(){
    try{
      const q=new URLSearchParams(location.search);
      const fromUrl = { label:q.get('label'), mins:q.get('mins'), unit:q.get('unit') };
      const saved=JSON.parse(localStorage.getItem('focus-timer-v1')||'{}');
      const data={...saved, ...Object.fromEntries(Object.entries(fromUrl).filter(([,v])=>v!==null))};
      if(data.label!=null) label.value=data.label;
      if(data.mins!=null) mins.value=data.mins;
      if(data.unit!=null) unit.value=data.unit;
    }catch(e){}
  }

  // init
  localLoad(); computeTotal(); draw(); updateShare();
})();
</script>
</body>
</html>
