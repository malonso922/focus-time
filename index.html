<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <title>Focus Timer • Countdown + Progress</title>
  <style>
    :root{
      --bg:#111111;         /* ClickUp dark */
      --panel:#161616;      /* card background */
      --accent:#4da3ff;     /* progress color */
      --accent-2:#49d47a;   /* late-stage color */
      --focus:#a970ff;      /* ClickUp-esque focus ring */
      --text:#eef3ff;
      --muted:#a7b2cc;
      --radius:16px;
    }
    *,*::before,*::after{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg);
      color:var(--text); font:14px/1.4 'Inter', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif;
      display:grid; place-items:center; padding:16px;
    }
    .card{
      width:min(640px,100%); background:var(--panel);
      border:1px solid rgba(255,255,255,.06); border-radius:var(--radius); box-shadow:0 10px 30px rgba(0,0,0,.4);
      padding:16px 16px 18px;
    }
    label{display:block; font-size:12px; color:var(--muted); margin-bottom:4px}
    input,select,button{
      border-radius:10px; border:1px solid rgba(255,255,255,.12); background:#0f0f0f; color:var(--text); padding:10px 12px; outline:none;
      transition:border-color .15s ease, box-shadow .15s ease;
    }
    input:focus,select:focus{
      border-color:var(--focus);
      box-shadow:0 0 0 2px color-mix(in srgb, var(--focus) 35%, transparent);
    }
    .grid{display:grid; grid-template-columns:minmax(0,1fr) minmax(0,1fr); gap:10px; align-items:start}
    @media (max-width:640px){.grid{grid-template-columns:minmax(0,1fr)}}

    /* chips under Duration */
    .presets{display:flex; gap:8px; flex-wrap:wrap; margin-top:8px}
    .chip{border:1px solid rgba(255,255,255,.15); background:#0f0f0f; padding:6px 10px; border-radius:999px; cursor:pointer; font-weight:600}
    .chip:hover{border-color:var(--accent)}

    /* progress + clock on right */
    .bar{height:14px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); border-radius:999px; overflow:hidden}
    .fill{height:100%; width:0%; background:var(--accent); transition:width .3s ease, background .3s ease}
    .barRow{display:flex; align-items:center; gap:10px}
    .clockRight{font-size:28px; font-weight:700; letter-spacing:.5px; text-align:right; min-width:96px}

    .meta{display:flex; justify-content:space-between; color:var(--muted); font-size:12px; margin-top:6px}

    .footer{display:flex; gap:10px; align-items:center; margin-top:12px; color:var(--muted)}
    .link{color:#b9d4ff; text-decoration:none}
    .link:hover{text-decoration:underline}
    .actions{margin-left:auto; display:flex; gap:8px; align-items:center}
    .iconbtn{width:36px; height:36px; display:grid; place-items:center; border-radius:10px; border:1px solid rgba(255,255,255,.12); background:#1f1f1f; cursor:pointer}
    .iconbtn svg{width:18px; height:18px; fill:none; stroke:#e8f0ff; stroke-width:2; stroke-linecap:round; stroke-linejoin:round}

    .hidden{display:none!important}
    .banner{margin:-4px 0 8px; font-size:16px; font-weight:800; text-align:center; color:#e6eeff}
  </style>
</head>
<body>
  <div class="card" id="app">
    <div class="banner hidden" id="banner"></div>

    <div class="grid">
      <div id="taskField">
        <label>Task name</label>
        <input id="label" type="text" placeholder="e.g., Series 65 Study Sprint" />
      </div>
      <div id="durationField">
        <label>Duration</label>
        <div style="display:flex; gap:8px">
          <input id="mins" type="number" min="1" step="1" value="25" style="width:110px"/>
          <select id="unit">
            <option value="min" selected>minutes</option>
            <option value="hr">hours</option>
          </select>
        </div>
        <div class="presets" id="presets">
          <span class="chip" data-mins="15">15m</span>
          <span class="chip" data-mins="25">25m</span>
          <span class="chip" data-mins="45">45m</span>
          <span class="chip" data-mins="60">60m</span>
        </div>
      </div>
    </div>

    <!-- progress + clock on right -->
    <div style="margin-top:12px">
      <div class="barRow">
        <div class="bar" id="bar">
          <div class="fill" id="fill"></div>
        </div>
        <div class="clockRight" id="clock">25:00</div>
      </div>
      <div class="meta">
        <div><span id="pct">0%</span> complete</div>
        <div>Elapsed: <span id="elapsed">0:00</span> • Remaining: <span id="remain">25:00</span></div>
      </div>
    </div>

    <!-- footer: share on left, action icons on right -->
    <div class="footer">
      <a class="link" href="#" id="shareLink">Share preset</a>
      <div class="actions">
        <button class="iconbtn" id="startBtn" title="Start" aria-label="Start">
          <!-- play -->
          <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
        </button>
        <button class="iconbtn" id="pauseBtn" title="Pause" aria-label="Pause" disabled>
          <!-- pause -->
          <svg viewBox="0 0 24 24"><path d="M10 5h2v14h-2zM14 5h2v14h-2z"/></svg>
        </button>
        <button class="iconbtn" id="resetBtn" title="Reset" aria-label="Reset" disabled>
          <!-- restart arrow -->
          <svg viewBox="0 0 24 24"><path d="M21 12a9 9 0 1 1-3.3-6.9"/><path d="M21 3v7h-7"/></svg>
        </button>
      </div>
    </div>
  </div>

  <audio id="ding" preload="auto">
    <source src="data:audio/mp3;base64,//uQZAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQCAAAACAAACbG1hAAAAAAAz//8AAP//AACQAAACcQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" type="audio/mpeg">
  </audio>

<script>
(function(){
  const $ = id=>document.getElementById(id);
  const label=$('label'), mins=$('mins'), unit=$('unit');
  const clock=$('clock');
  const startBtn=$('startBtn'), pauseBtn=$('pauseBtn'), resetBtn=$('resetBtn');
  const bar=$('bar'), fill=$('fill'), pct=$('pct'), elapsed=$('elapsed'), remain=$('remain');
  const ding=$('ding');
  const presets=$('presets');
  const shareLink=$('shareLink');
  const banner=$('banner');
  const taskField=$('taskField');
  const durationField=$('durationField');

  let totalMs=0, startAt=0, elapsedMs=0, timer=null, running=false;

  const clamp=(n,min,max)=>Math.max(min,Math.min(max,n));
  function fmt(ms){
    ms=Math.max(0,Math.floor(ms/1000));
    const h=Math.floor(ms/3600), m=Math.floor((ms%3600)/60), s=ms%60;
    return h? `${h}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}` : `${m}:${String(s).padStart(2,'0')}`;
  }

  function computeTotal(){
    const v=parseFloat(mins.value||0);
    totalMs = (unit.value==='hr'? v*60 : v) * 60*1000;
    totalMs = Math.max(1000,totalMs);
  }

  function updateShare(){
    const params=new URLSearchParams({label:label.value, mins:mins.value, unit:unit.value});
    shareLink.href = `${location.origin}${location.pathname}?${params.toString()}`;
  }

  function draw(){
    const done=clamp(elapsedMs,0,totalMs);
    const p = Math.round( (done/totalMs)*100 );
    fill.style.width = p + '%';
    fill.style.background = p>=100? '#646b7a' : (p<67? 'var(--accent)' : 'var(--accent-2)');
    pct.textContent = p + '%';
    clock.textContent = fmt(totalMs - done);
    elapsed.textContent = fmt(done);
    remain.textContent = fmt(totalMs - done);
  }

  function setState(newRunning){
    running=newRunning;
    startBtn.disabled=running; pauseBtn.disabled=!running; resetBtn.disabled=!running && elapsedMs===0;
  }

  function start(){
    computeTotal();
    if(elapsedMs>=totalMs){ elapsedMs=0; }
    if(!running){ startAt=Date.now()-elapsedMs; timer=requestAnimationFrame(tick); setState(true); }
    // show banner; hide inputs + preset chips; hide Start icon
    banner.textContent = label.value || 'Untitled Task';
    banner.classList.remove('hidden');
    taskField.classList.add('hidden');
    durationField.classList.add('hidden');
    startBtn.classList.add('hidden');
  }

  function pause(){
    if(running){ cancelAnimationFrame(timer); elapsedMs=Date.now()-startAt; setState(false); draw(); }
  }

  function reset(){
    cancelAnimationFrame(timer); elapsedMs=0; setState(false); draw();
    // restore UI
    banner.classList.add('hidden');
    taskField.classList.remove('hidden');
    durationField.classList.remove('hidden');
    startBtn.classList.remove('hidden');
  }

  function tick(){
    elapsedMs = Date.now()-startAt;
    if(elapsedMs>=totalMs){
      elapsedMs=totalMs; draw(); setState(false);
      try{ ding.currentTime=0; ding.play().catch(()=>{});}catch(e){}
      try{ if('Notification' in window && Notification.permission==='granted'){ new Notification('Timer done', { body: label.value || 'Focus timer complete' }); } }catch(e){}
      return;
    }
    draw(); timer=requestAnimationFrame(tick);
  }

  // events
  [label, mins, unit].forEach(el=>{
    el.addEventListener('input',()=>{ updateShare(); localSave(); draw(); });
    el.addEventListener('change',()=>{ updateShare(); localSave(); draw(); });
  });
  startBtn.addEventListener('click', ()=>{ start(); localSave(); });
  pauseBtn.addEventListener('click', ()=>{ pause(); localSave(); });
  resetBtn.addEventListener('click', ()=>{ reset(); localSave(); });

  presets.addEventListener('click', (e)=>{
    const chip=e.target.closest('.chip');
    if(!chip) return;
    mins.value = chip.dataset.mins;
    unit.value = 'min';
    elapsedMs=0; draw(); updateShare(); localSave();
  });

  document.addEventListener('keydown', (e)=>{
    if(e.code==='Space'){ e.preventDefault(); running? pause(): start(); }
    if(e.key==='r' || e.key==='R'){ reset(); }
  });
  try{ if('Notification' in window && Notification.permission==='default'){ Notification.requestPermission().catch(()=>{}); } }catch(e){}

  function localSave(){
    const data={label:label.value, mins:mins.value, unit:unit.value};
    try{ localStorage.setItem('focus-timer-v1', JSON.stringify(data)); }catch(e){}
  }
  function localLoad(){
    try{
      const q=new URLSearchParams(location.search);
      const fromUrl = { label:q.get('label'), mins:q.get('mins'), unit:q.get('unit') };
      const saved=JSON.parse(localStorage.getItem('focus-timer-v1')||'{}');
      const data={...saved, ...Object.fromEntries(Object.entries(fromUrl).filter(([,v])=>v!==null))};
      if(data.label!=null) label.value=data.label;
      if(data.mins!=null) mins.value=data.mins;
      if(data.unit!=null) unit.value=data.unit;
    }catch(e){}
  }

  // init
  localLoad(); computeTotal(); draw(); updateShare();
})();
</script>
</body>
</html>
